<!DOCTYPE html>
<html>
<head>
  <title>System Architecture Diagram</title>
  <style>
    body { 
      margin: 0;
      padding: 20px;
      background: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    #diagram-container {
      max-width: 600px;
      margin: 0 auto;
    }
    svg {
      width: 100%;
      height: auto;
      display: block;
    }
    .box {
      fill: white;
      stroke: #2c3e50;
      stroke-width: 2;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
    }
    .box-user { fill: #ffeaa7; }
    .box-frontend { fill: #74b9ff; }
    .box-backend { fill: #a29bfe; }
    .box-database { fill: #fd79a8; }
    .box-calculation { fill: #00b894; }
    .box-output { fill: #fab1a0; }
    text {
      font-family: 'Segoe UI', sans-serif;
      fill: #2c3e50;
    }
    .title-text {
      font-size: 18px;
      font-weight: bold;
    }
    .subtitle-text {
      font-size: 12px;
    }
    .arrow-line {
      stroke: #3498db;
      stroke-width: 2;
      fill: none;
      marker-end: url(#arrowhead);
    }
    .arrow-bidirectional {
      stroke: #e91e63;
      stroke-width: 2;
      fill: none;
    }
    .arrow-label {
      font-size: 11px;
      fill: #555;
      font-style: italic;
    }
    #download-btn {
      display: block;
      margin: 20px auto;
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      font-weight: bold;
    }
    #download-btn:hover {
      background: #5568d3;
    }
  </style>
</head>
<body>
  <div id="diagram-container">
    <svg id="architecture-diagram" viewBox="0 0 800 1100" xmlns="http://www.w3.org/2000/svg">
      <!-- Arrow marker definitions -->
      <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
          <polygon points="0 0, 10 3, 0 6" fill="#3498db" />
        </marker>
      </defs>

      <!-- User Layer -->
      <rect x="250" y="20" width="300" height="80" rx="10" class="box box-user"/>
      <text x="400" y="45" text-anchor="middle" class="title-text">üë§ User</text>
      <text x="400" y="65" text-anchor="middle" class="subtitle-text">Browser Interface</text>
      <text x="400" y="82" text-anchor="middle" class="subtitle-text">AJAX Requests</text>

      <!-- Arrow: User to Frontend -->
      <line x1="400" y1="100" x2="400" y2="130" class="arrow-line"/>
      <text x="420" y="120" class="arrow-label">HTTP POST/GET</text>

      <!-- Frontend Layer -->
      <rect x="250" y="140" width="300" height="120" rx="10" class="box box-frontend"/>
      <text x="400" y="165" text-anchor="middle" class="title-text">üé® Frontend</text>
      <text x="400" y="185" text-anchor="middle" class="subtitle-text">HTML Templates</text>
      <text x="400" y="202" text-anchor="middle" class="subtitle-text">JavaScript/jQuery</text>
      <text x="400" y="219" text-anchor="middle" class="subtitle-text">Bootstrap CSS</text>
      <text x="400" y="236" text-anchor="middle" class="subtitle-text">Chart.js Visualization</text>
      <text x="400" y="253" text-anchor="middle" class="subtitle-text">Django Template Engine</text>

      <!-- Arrow: Frontend to Django Views -->
      <line x1="400" y1="260" x2="400" y2="270" class="arrow-line"/>
      <text x="420" y="268" class="arrow-label">HTTP Request</text>

      <!-- Django Views Layer -->
      <rect x="250" y="280" width="300" height="140" rx="10" class="box box-backend"/>
      <text x="400" y="305" text-anchor="middle" class="title-text">‚öôÔ∏è Django Views</text>
      <text x="400" y="325" text-anchor="middle" class="subtitle-text">URL Routing</text>
      <text x="400" y="342" text-anchor="middle" class="subtitle-text">Request Controllers</text>
      <text x="400" y="359" text-anchor="middle" class="subtitle-text">Balance Algorithm</text>
      <text x="400" y="376" text-anchor="middle" class="subtitle-text">Authentication</text>
      <text x="400" y="393" text-anchor="middle" class="subtitle-text">Session Management</text>
      <text x="400" y="410" text-anchor="middle" class="subtitle-text">JSON API Endpoints</text>

      <!-- Bidirectional Arrow: Django to Database -->
      <line x1="400" y1="420" x2="400" y2="430" class="arrow-bidirectional"/>
      <polygon points="400,430, 395,423, 405,423" fill="#e91e63"/>
      <polygon points="400,420, 395,427, 405,427" fill="#e91e63"/>
      <text x="420" y="428" class="arrow-label">ORM Queries</text>

      <!-- Database Layer -->
      <rect x="250" y="440" width="300" height="160" rx="10" class="box box-database"/>
      <text x="400" y="465" text-anchor="middle" class="title-text">üíæ Database</text>
      <text x="400" y="485" text-anchor="middle" class="subtitle-text">SQLite Database</text>
      <text x="400" y="502" text-anchor="middle" class="subtitle-text">Django ORM</text>
      <text x="400" y="519" text-anchor="middle" class="subtitle-text">LandUse Model</text>
      <text x="400" y="536" text-anchor="middle" class="subtitle-text">RenewableData Model</text>
      <text x="400" y="553" text-anchor="middle" class="subtitle-text">VerbrauchData Model</text>
      <text x="400" y="570" text-anchor="middle" class="subtitle-text">Cascade Updates</text>
      <text x="400" y="587" text-anchor="middle" class="subtitle-text">Formula Storage</text>

      <!-- Bidirectional Arrow: Database to Calculation Engine -->
      <line x1="400" y1="600" x2="400" y2="610" class="arrow-bidirectional"/>
      <polygon points="400,610, 395,603, 405,603" fill="#e91e63"/>
      <polygon points="400,600, 395,607, 405,607" fill="#e91e63"/>
      <text x="420" y="608" class="arrow-label">Data Exchange</text>

      <!-- Calculation Engine Layer -->
      <rect x="250" y="620" width="300" height="160" rx="10" class="box box-calculation"/>
      <text x="400" y="645" text-anchor="middle" class="title-text">üî¨ Calculation Engine</text>
      <text x="400" y="665" text-anchor="middle" class="subtitle-text">bilanz_engine.py</text>
      <text x="400" y="682" text-anchor="middle" class="subtitle-text">renewable_engine.py</text>
      <text x="400" y="699" text-anchor="middle" class="subtitle-text">verbrauch_engine.py</text>
      <text x="400" y="716" text-anchor="middle" class="subtitle-text">landuse_engine.py</text>
      <text x="400" y="733" text-anchor="middle" class="subtitle-text">formula_evaluator.py</text>
      <text x="400" y="750" text-anchor="middle" class="subtitle-text">Binary Search Algorithm</text>
      <text x="400" y="767" text-anchor="middle" class="subtitle-text">Energy Balance Logic</text>

      <!-- Arrow: Calculation to Output -->
      <line x1="400" y1="780" x2="400" y2="790" class="arrow-line"/>
      <text x="420" y="788" class="arrow-label">Processed Data</text>

      <!-- Output Layer -->
      <rect x="250" y="800" width="300" height="140" rx="10" class="box box-output"/>
      <text x="400" y="825" text-anchor="middle" class="title-text">üìä Output</text>
      <text x="400" y="845" text-anchor="middle" class="subtitle-text">JSON Responses</text>
      <text x="400" y="862" text-anchor="middle" class="subtitle-text">Chart Data</text>
      <text x="400" y="879" text-anchor="middle" class="subtitle-text">Energy Balance Results</text>
      <text x="400" y="896" text-anchor="middle" class="subtitle-text">Visualization Data</text>
      <text x="400" y="913" text-anchor="middle" class="subtitle-text">Dashboard Metrics</text>
      <text x="400" y="930" text-anchor="middle" class="subtitle-text">Real-time Updates</text>

      <!-- Return Arrow: Output back to Frontend -->
      <path d="M 550 870 L 650 870 L 650 200 L 550 200" 
            stroke="#3498db" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
      <text x="660" y="535" class="arrow-label">Response Data</text>
    </svg>
  </div>

  <button id="download-btn" onclick="downloadPNG()">üì• Download as PNG</button>

  <script>
    function downloadPNG() {
      const svg = document.getElementById('architecture-diagram');
      const svgData = new XMLSerializer().serializeToString(svg);
      
      // Create canvas
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      // Set canvas size (higher resolution for better quality)
      canvas.width = 1200;
      canvas.height = 1650;
      
      // Create image from SVG
      const img = new Image();
      const blob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      
      img.onload = function() {
        // White background
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Draw SVG on canvas
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        
        // Convert to PNG and download
        canvas.toBlob(function(blob) {
          const link = document.createElement('a');
          link.download = 'system_architecture_diagram.png';
          link.href = URL.createObjectURL(blob);
          link.click();
          URL.revokeObjectURL(url);
        }, 'image/png');
      };
      
      img.src = url;
    }
  </script>
</body>
</html>
